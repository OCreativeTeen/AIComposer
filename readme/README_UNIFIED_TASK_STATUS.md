# 统一任务状态窗口功能说明

## 概述

新版本的魔法工作流GUI增加了统一的任务状态窗口，显示在所有标签页的底部，提供实时的任务监控和完成通知功能。

## 主要功能

### 1. 统一状态显示
- **位置**: 所有标签页底部
- **实时更新**: 每2秒自动刷新状态
- **统计信息**: 显示运行中和已完成任务数量
- **状态图标**: 使用清晰的emoji图标标识任务状态

### 2. 任务状态分类

#### 运行中的任务 🔄
- 显示任务类型、项目ID和运行时间
- 实时更新运行持续时间
- 清晰的视觉反馈

#### 已完成的任务 ✅❌
- 区分成功完成和失败的任务
- 显示完成时间
- 显示结果或错误信息
- 最多显示最近5个完成的任务

### 3. 自动通知系统
- **弹窗通知**: 任务完成时自动弹出通知对话框
- **成功通知**: 显示任务结果和相关信息
- **失败通知**: 显示错误信息和调试信息
- **避免重复**: 每个任务只通知一次

### 4. 控制按钮

#### 刷新状态
- 手动强制刷新任务状态
- 更新显示内容

#### 清空已完成
- 从列表中移除已完成的任务
- 保留运行中的任务
- 重置通知跟踪

#### 清空全部
- 清除所有任务记录
- 重置所有状态
- 适用于开始新的工作会话

## 增强的任务跟踪

### 任务生命周期管理
- **创建时**: 分配唯一ID，记录开始时间
- **运行中**: 实时显示进度和持续时间
- **完成时**: 自动通知，移至完成列表
- **历史记录**: 保留最近完成任务的信息

### 任务状态字段
```json
{
    "type": "任务类型",
    "status": "运行中/完成/失败",
    "start_time": "开始时间",
    "pid": "项目ID",
    "result": "结果信息（成功时）",
    "error": "错误信息（失败时）"
}
```

## 支持的任务类型

1. **create_script** - 生成脚本
2. **text_to_speech** - 文本转语音
3. **generate_summary** - 生成摘要
4. **create_all_images** - 生成所有图像
5. **save_and_regenerate_image** - 保存并重新生成单个图像
6. **create_video** - 生成完整视频
7. **create_video_lite** - 生成轻量视频
8. **transcript_youtube** - YouTube转录

## 界面改进

### 布局优化
- **窗口尺寸**: 增大到1200x800以容纳状态区域
- **输出区域**: 各标签页的输出区域高度调整为10行
- **状态区域**: 固定高度6行，横跨整个窗口底部

### 用户体验提升
- **即时反馈**: 任务完成立即通知
- **状态统计**: 一目了然的任务数量统计
- **历史记录**: 查看最近完成的任务
- **清理功能**: 灵活的状态清理选项

## 技术实现

### 定时器系统
- 使用`root.after()`方法实现非阻塞的定时更新
- 2秒间隔确保及时更新而不影响性能

### 线程安全
- 所有UI更新都在主线程中执行
- 使用`root.after(0, callback)`确保线程安全

### 内存管理
- 限制显示的完成任务数量（最多5个）
- 提供清理功能避免内存积累

## 使用建议

1. **监控长时间任务**: 特别适合监控图像生成、视频制作等耗时任务
2. **及时响应通知**: 任务完成后及时查看结果或错误信息
3. **定期清理**: 完成一批任务后清空状态，保持界面整洁
4. **错误排查**: 失败任务的错误信息有助于快速定位问题

## 未来扩展

- [ ] 任务进度条显示
- [ ] 任务取消功能
- [ ] 任务日志导出
- [ ] 自定义通知设置
- [ ] 任务优先级管理 