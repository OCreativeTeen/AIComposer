# 热门视频下载工作流程

## 概述

热门视频下载功能分为两个独立的步骤,使得流程更清晰,用户可以先获取视频列表,再选择性下载。

---

## 工作流程

### 步骤 1: 获取热门视频列表 (热门寻找)

**按钮**: `热门寻找`

**功能**: 从 YouTube 频道获取视频列表,按观看次数排序,保存到 JSON 文件。

#### 操作步骤:

1. 点击 **"热门寻找"** 按钮

2. **输入频道信息**:
   - 频道或播放列表URL (例如: `https://www.youtube.com/@频道名/videos`)
   - 最大视频数量 (默认: 100)
   - 最小观看次数 (默认: 100)

3. **等待获取**:
   - 系统会显示 "正在获取视频列表，请稍候..."
   - 后台线程会获取所有视频的详细信息
   - 包括: 标题、观看次数、时长、上传日期、频道名等

4. **自动保存**:
   - 视频列表按观看次数降序排序
   - 自动保存到 JSON 文件
   - 文件名格式: `{日期}_{频道名}_hotvideos.json`
   - 示例: `20260118_心理造夢坊_hotvideos.json`
   - 保存位置: `项目目录/Youtbue_download/`

5. **成功提示**:
   ```
   成功获取 100 个视频！
   
   列表已保存到:
   20260118_心理造夢坊_hotvideos.json
   
   您可以通过 '热门下载' 按钮选择此文件进行下载。
   ```

---

### 步骤 2: 选择并下载视频 (热门下载)

**按钮**: `热门下载`

**功能**: 从保存的 JSON 文件加载视频列表,让用户选择要下载的视频。

#### 操作步骤:

1. 点击 **"热门下载"** 按钮

2. **选择 JSON 文件**:
   - 系统打开文件选择对话框
   - 默认筛选 `*_hotvideos.json` 文件
   - 选择之前保存的视频列表文件

3. **查看视频列表**:
   - 显示所有视频信息:
     - 序号
     - 标题 (最多显示80字符)
     - 观看次数 (格式化显示,如 "1,234,567")
     - 时长 (格式: MM:SS)
     - 上传者
   - 按观看次数降序排列

4. **选择视频**:
   - 单击选择单个视频
   - Ctrl+单击 或 Shift+单击 多选
   - 点击 "全选" 选择所有视频
   - 点击 "取消全选" 清空选择
   - 底部显示: "已选择: X 个视频"

5. **确认下载**:
   - 点击 "下载选中" 按钮
   - 确认对话框: "确定要下载 X 个视频吗?"

6. **批量下载**:
   - 显示下载进度对话框
   - 显示当前下载的视频信息和进度
   - 视频文件命名: `{观看次数:010d}_{上传日期}_{标题}.mp4`
   - 示例: `0001234567_20240115_视频标题.mp4`

7. **下载完成**:
   - 自动保存下载记录到新的 JSON 文件
   - 文件名格式: `{日期}_{频道名}_downloads.json`
   - 可通过 "下载列表审阅" 查看和管理

---

## JSON 文件格式

### 热门视频列表文件 (`*_hotvideos.json`)

```json
[
  {
    "title": "视频标题",
    "url": "https://www.youtube.com/watch?v=xxxxx",
    "id": "视频ID",
    "duration": 1234,
    "view_count": 1234567,
    "uploader": "上传者名称",
    "channel": "频道名称",
    "channel_id": "UCxxxxxxxx",
    "upload_date": "20240115",
    "thumbnail": "缩略图URL",
    "description": "视频描述前200字"
  },
  ...
]
```

### 下载记录文件 (`*_downloads.json`)

```json
{
  "download_date": "2026-01-18 15:30:45",
  "channel_name": "频道名称",
  "total_videos": 10,
  "videos": [
    {
      "url": "https://www.youtube.com/watch?v=xxxxx",
      "title": "视频标题",
      "view_count": 1234567,
      "upload_date": "20240115",
      "duration": 1234,
      "file_path": "/path/to/video.mp4",
      "transcription_path": null,
      "transcription_status": "未转录"
    },
    ...
  ]
}
```

---

## 按钮对比

| 按钮 | 功能 | 输入 | 输出 |
|------|------|------|------|
| **热门寻找** | 获取视频列表 | 频道URL | `*_hotvideos.json` |
| **热门下载** | 下载视频 | `*_hotvideos.json` | 视频文件 + `*_downloads.json` |
| **下载列表审阅** | 查看下载记录 | `*_downloads.json` | 可转录 |

---

## 优势

### 1. **分离关注点**
- **热门寻找**: 专注于获取和筛选视频列表
- **热门下载**: 专注于下载已选视频
- 职责清晰,易于维护

### 2. **灵活性**
- 可以先获取多个频道的视频列表
- 稍后再决定下载哪些视频
- 可以多次下载同一列表中的不同视频

### 3. **效率**
- 避免重复获取视频信息
- 可以离线查看视频列表(JSON文件)
- 减少对 YouTube API 的请求次数

### 4. **可追溯**
- 所有操作都有 JSON 记录
- 可以查看历史获取的视频列表
- 可以比较不同时间的视频观看次数变化

### 5. **容错性**
- 如果下载中断,可以重新选择 JSON 文件继续
- 不需要重新获取视频列表
- 下载失败的视频可以单独重试

---

## 使用场景

### 场景 1: 快速浏览和选择性下载

1. 使用 **"热门寻找"** 获取频道的所有热门视频
2. 查看保存的 JSON 文件,了解视频列表
3. 使用 **"热门下载"** 只下载感兴趣的视频

### 场景 2: 批量管理多个频道

1. 依次对多个频道使用 **"热门寻找"**
2. 得到多个 `*_hotvideos.json` 文件
3. 根据需要,选择不同的文件进行下载

### 场景 3: 定期更新

1. 定期使用 **"热门寻找"** 获取最新的视频列表
2. 比较新旧 JSON 文件,发现新增视频
3. 下载新增的热门视频

### 场景 4: 数据分析

1. 收集同一频道在不同时间的 `*_hotvideos.json`
2. 分析视频观看次数的增长趋势
3. 识别持续热门的视频

---

## 文件组织建议

```
项目目录/
└── Youtbue_download/
    ├── 20260118_频道A_hotvideos.json       # 热门视频列表
    ├── 20260118_频道A_downloads.json       # 下载记录
    ├── 0001234567_20240115_视频1.mp4      # 下载的视频
    ├── 0001234567_20240115_视频1.json     # 转录文本
    ├── 0001234567_20240115_视频1.txt
    ├── 20260119_频道B_hotvideos.json
    ├── 20260119_频道B_downloads.json
    └── ...
```

---

## 注意事项

1. **Cookies 配置**: 确保 `youtube_cookies.txt` 文件有效,否则可能无法获取视频信息
2. **网络连接**: 获取视频列表和下载都需要稳定的网络连接
3. **磁盘空间**: 下载前确保有足够的磁盘空间
4. **观看次数**: 观看次数是获取时的数据,实际数值会持续增长
5. **视频可用性**: 保存在 JSON 中的视频可能会被删除或设为私密

---

## 相关文档

- [README_YOUTUBE_COOKIES.md](README_YOUTUBE_COOKIES.md) - Cookies 配置指南
- [README_YOUTUBE_TROUBLESHOOTING.md](README_YOUTUBE_TROUBLESHOOTING.md) - 故障排除
- [README_YOUTUBE_CHANNEL_FIELDS.md](README_YOUTUBE_CHANNEL_FIELDS.md) - 频道字段说明

---

**最后更新**: 2026-01-18
